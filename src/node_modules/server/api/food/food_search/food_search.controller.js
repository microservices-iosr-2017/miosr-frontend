import assign from 'lodash/assign';
import {handleError} from 'server/api/common';
import config from '../../../config/environment';


var request = require('request-promise').defaults({
  baseUrl: config.ndb.baseUrl,
});

var qs = {api_key: config.ndb.apiKey};

function respondWithResult(res, statusCode) {
  statusCode = statusCode || 200;
  return function onSuccess(entity){
    if(entity){
      res.status(statusCode).json(JSON.parse(entity))
    }
  };
}

export function index(req, res){
  request.get({
    url: '/search',
    qs: assign(qs, {
      q: req.params.name,
      format: 'json',
      sort: 'r',
    }),
  }).then(respondWithResult(res))
    .catch(handleError(res));
}
