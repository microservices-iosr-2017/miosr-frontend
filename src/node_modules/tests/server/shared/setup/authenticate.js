import app from 'server';
import request from 'supertest-as-promised';

export async function authenticate() {
  const user = await FactoryGirl.create('user');
  const response = await request(app)
    .post('/auth/local')
    .set('Content-Type', 'application/json')
    .send({username: user.email, password: 'test', transportMethod: 'RES_BODY'})
    .expect(200);
  if (!response.body.accessToken) {
    throw new Error('Access token missing in response form local auth service');
  } else {
    return response.body.accessToken;
  }
}

export const tokenCookie = (token) => {
  return `access_token=${token}`;
};
