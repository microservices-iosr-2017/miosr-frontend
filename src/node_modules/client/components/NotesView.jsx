import React from 'react';

import ListGroup from 'react-bootstrap/lib/ListGroup';
import ListGroupItem from 'react-bootstrap/lib/ListGroupItem';
import Button from 'react-bootstrap/lib/Button';

import './NotesView.scss';

function NotesList(props) {
  const items = [];

  for(let itemId = 0; itemId < props.list.length; itemId += 1) {
    items.push(
      <ListGroupItem key={itemId} onClick={() => props.onSelect(itemId)}>
        {props.list[itemId].title}
      </ListGroupItem>
    )
  }

  return (
    <ListGroup>
      {items}
    </ListGroup>
  );
}

function NoteEditor(props) {
  if (props.note)
    return (
      <div>
        <p className="note-title">{props.note.title}</p>
        <p className="note-content">{props.note.text}</p>
      </div>
    );
  else
    return (<span></span>);
}

export default class NotesView extends React.Component {
  constructor(props) {
    super();
    this.actionHolder = props.actions;
    this.store = props.store;

    this.state = {};
    this.state.storeState = props.store.getState();
    this.onStoreChanged = this.onStoreChanged.bind(this)
  }

  componentDidMount() {
    this.store.listen(this.onStoreChanged);

    setTimeout(() => this.actionHolder.fetch());
  }

  componentWillUnmount() {
    this.store.unlisten(this.onStoreChanged);
  }

  onStoreChanged(state) {
    this.setState({storeState: state});
  }

  render() {
    return (
      <div className="note-view-container">
        <div className="row">
          <div className="col-sm-4">
            <NotesList
              list={this.state.storeState.notesList}
              onSelect={(id) => this.actionHolder.select(id)}
              onDeselect={() => this.actionHolder.deselect()}
            />

            <Button
              id="add_button"
              type="submit"
              onClick={e => this.actionHolder.add()}>+</Button>

          </div>
          <div className="col-sm-8">
            <NoteEditor
              note={this.state.storeState.selectedNote}
              editable={this.state.storeState.selectionEditable}
            />
          </div>
        </div>



      </div>
    );
  }
};
