
class AppStore {
  constructor(axios, appActions, loginUrl) {
    this.bindListeners({
      onLogin: appActions.LOGIN,
      onLoginSuccess: appActions.LOGIN_SUCCESS,
    });

    this._axios = axios;
    this._actions = appActions;
    this._loginUrl = loginUrl;
    this.loggedIn = false;
    this.token = null;
  }

  onLogin({username, password}) {
    this._axios.post(this._loginUrl, {username, password})
      .then(response => {
        // payload in response.data
        this._actions.loginSuccess(response.data.token);
      })
      .catch(error => {
        // access response via error.response
        this._actions.loginFailure(error.response);
      });
  }

  onLoginSuccess({token}) {
    this.setState({loggedIn: true, token});
  }
}

export default function build({altInstance, axios, appActions, loginUrl}) {
  return altInstance.createStore(AppStore, 'AppStore', axios, appActions, loginUrl);
}
