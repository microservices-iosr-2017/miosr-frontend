import 'babel-polyfill';
import 'client/sharedjs/fetch-polyfill';
import React from 'react';
import ReactDOM from 'react-dom';
import {createHistory} from 'history';
import {Router, Route, IndexRoute, useRouterHistory} from 'react-router';

import * as auth from 'client/sharedjs/auth';
import {ensureCookiesEnabled} from 'client/sharedjs/cookies';

import './index.scss';
import {HomeLoggedOut} from './components/Home';
import {LoggedOutApp} from '../app/components/App';


const history = useRouterHistory(createHistory)({basename: '/'});

function index() {
  if (auth.isCookiePresent()) {
    window.location.href = auth.getCachedRedirectionUrl();
  } else {
    ReactDOM.render(
      <Router history={history}>
        <Route path="/" component={LoggedOutApp}>
          <IndexRoute component={HomeLoggedOut} />
        </Route>
      </Router>,
      document.getElementById('content')
    );
  }
}

ensureCookiesEnabled(index);

