import Subscriber from './Subscriber';

export default (...stores) =>
  (superclass) => class extends Subscriber(superclass) {
    constructor(...args) {
      super(...args);

      this.state = this.getStateFromStores();
      this.setStateFromStores = this.setStateFromStores.bind(this);
    }

    componentDidMount() {
      stores.forEach(store => this.addHandler(store, this.setStateFromStores));
    }

    componentWillUnmount() {
      this.destroyHandlers();
    }

    getStateFromStores() {
      return stores.reduce((state, store) => Object.assign(state, store.getState()), {});
    }

    setStateFromStores() {
      this.setState(this.getStateFromStores());
    }
  };
