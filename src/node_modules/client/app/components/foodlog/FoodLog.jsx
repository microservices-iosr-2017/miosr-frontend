import React from 'react';
import moment from 'moment';

import storeStateSubscriberCreator from 'client/app/mixins/StoreStateSubscriber';

import MealsStore from 'client/app/stores/MealsStore';
import MealsActions from 'client/app/actions/MealsActions';

import {Grid, Row} from 'react-bootstrap';
import ListGroup from 'react-bootstrap/lib/ListGroup';
import ListGroupItem from 'react-bootstrap/lib/ListGroupItem';
import DatePicker from 'react-bootstrap-date-picker';
import AddMeal from './AddMeal';
import TodayNutrients from './TodayNutrients';

import './foodlog.scss';

const MealsStoreStateSubscriber = storeStateSubscriberCreator(MealsStore);
export default class FoodLog extends MealsStoreStateSubscriber(React.Component) {
  componentDidMount() {
    super.componentDidMount();
    MealsActions.fetchMeals();
  }

  render() {
    return (
      <section className="c__foodlog">
        <Grid>
          <Row>
            <h2>Food Log</h2>

            <DatePicker value={this.state.date.toISOString()}
                        onChange={dateStr => MealsActions.changeDate(moment(dateStr))} />

            <ListGroup className="mealsList">
              {this.state.meals.map(meal =>
                (<ListGroupItem key={meal._id}>
                  <span className="mealName">{meal.name}</span>
                  <span className="mealQuantity">{meal.quantity} g</span>
                </ListGroupItem>)
              )}
            </ListGroup>

            <AddMeal onAdd={({name, ndbno}, quantity) =>
              MealsActions.addMeal(this.state.date.toISOString(), name, ndbno, quantity)
            } />

            <TodayNutrients dataReady={this.state.chartDataReady}
                            values={this.state.nutrientsTodayCumulative}
                            units={this.state.nutrientsTodayCumulativeUnits} />
          </Row>
        </Grid>
      </section>
    );
  }
}
