import every from 'lodash/fp/every';
import React, {PropTypes} from 'react';
import RecipeActions from 'actions/RecipeActions';
import {IngredientTypes} from 'schemas/IngredientSchema';
import {nonEmptyIngredient} from 'helpers/IngredientHelper';

import IngredientList from './IngredientList';

const allNonEmptyIngredients = (ingredients) =>
  ingredients.length === 0 || every(nonEmptyIngredient)(ingredients);

class IngredientListContainer extends React.Component {
  componentDidMount() {
    if (allNonEmptyIngredients(this.props.ingredients)) {
      RecipeActions.addIngredient.defer();
    }
  }

  componentWillReceiveProps(nextProps) {
    if (allNonEmptyIngredients(nextProps.ingredients)) {
      RecipeActions.addIngredient();
    }
  }

  render() {
    const {ingredients} = this.props;
    return (
      <IngredientList ingredients={ingredients}
                      onChange={(ingredientId, key, value) =>
                        RecipeActions.updateIngredient(ingredientId, key, value)}
                      onDelete={(ingredientId) =>
                        RecipeActions.removeIngredient(ingredientId)} />
    );
  }
}

IngredientListContainer.propTypes = {
  ingredients: PropTypes.arrayOf(IngredientTypes).isRequired
};

export default IngredientListContainer;
